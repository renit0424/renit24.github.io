<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>津波情報-P2P地震情報バージョン</title>

<style>
/* ===== リセット ===== */
* {
  box-sizing: border-box;
}

/* ===== 画面全体 ===== */
html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  background: #000;
  overflow: hidden;
  font-family: "Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
}

/* ===== 16:9 固定コンテナ ===== */
.screen {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100vw;
  height: calc(100vw * 9 / 16);
  max-height: 100vh;
  max-width: calc(100vh * 16 / 9);
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: #fff;
  padding: 16px;
  display: flex;
  flex-direction: column;
}

/* ===== タイトル帯 ===== */
.title-bar {
  background: #c40000;
  color: #fff;
  font-weight: bold;
  font-size: 2.2vh;
  padding: 10px 14px;
  margin-bottom: 6px;
}

/* ===== 上部情報 ===== */
.updated {
  display: flex;
  justify-content: space-between;
  font-size: 1.6vh;
  color: #ddd;
  margin-bottom: 6px;
}

#pageInfo {
  font-weight: bold;
  color: #ffd400;
}

/* ===== テーブル ===== */
table {
  width: 100%;
  border-collapse: collapse;
  flex: 1;
}

thead th {
  background: #333;
  padding: 10px;
  font-size: 1.8vh;
  text-align: left;
}

tbody td {
  padding: 12px;
  font-size: 2.1vh;
}

tbody tr {
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

/* ===== 強調 ===== */
td:nth-child(3),
td:nth-child(4) {
  font-weight: bold;
  font-size: 2.4vh;
}

td:nth-child(4) {
  color: #ffd400;
}

/* ===== 区分色 ===== */
tr.major-warning { background: #7b1fa2; }
tr.warning       { background: #c40000; }
tr.advisory      { background: #b59f00; color:#000; }
tr.forecast      { background: #1e88e5; }

/* ===== フルスクリーン案内（初回のみ） ===== */
.hint {
  position: absolute;
  bottom: 8px;
  right: 12px;
  font-size: 1.2vh;
  color: rgba(255,255,255,0.5);
}
</style>
</head>

<body>

<div class="screen" id="screen">

  <div class="title-bar">津波の予想時刻・高さ</div>

  <div class="updated">
    <span id="updatedTime"></span>
    <span id="pageInfo"></span>
  </div>

  <table id="tsunamiTable">
    <thead>
      <tr>
        <th>区分</th>
        <th>地域</th>
        <th>到達情報</th>
        <th>最大津波高</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="hint">※ クリックで全画面表示</div>

</div>

<script>
const url = "https://api.p2pquake.net/v2/jma/tsunami";

const pageSize = 6;
let allItems = [];
let currentPage = 0;
let rotateTimer = null;

/* 到達時刻 */
function formatArrivalTime(iso) {
  if (!iso) return "";
  const d = new Date(iso);
  return `${String(d.getHours()).padStart(2,"0")}時${String(d.getMinutes()).padStart(2,"0")}分頃`;
}

/* 行クラス */
function categoryClass(category) {
  if (!category) return "";
  if (category.includes("大津波警報")) return "major-warning";
  if (category.includes("警報")) return "warning";
  if (category.includes("注意報")) return "advisory";
  if (category.includes("津波予報")) return "forecast";
  return "";
}

/* ページ番号 */
function updatePageInfo() {
  const el = document.getElementById("pageInfo");
  if (allItems.length <= pageSize) {
    el.textContent = "";
    return;
  }
  el.textContent = `${currentPage + 1}/${Math.ceil(allItems.length / pageSize)}`;
}

/* 表描画 */
function renderPage(page) {
  const tbody = document.querySelector("#tsunamiTable tbody");
  tbody.innerHTML = "";

  allItems.slice(page * pageSize, page * pageSize + pageSize).forEach(areas => {
    const tr = document.createElement("tr");
    tr.className = categoryClass(areas.grade.replace("MajorWarning","大津波警報").replace("Warning","津波警報").replace("Watch","津波注意報") ?? "");
 
    const fh = areas.firstHeight ?? {};
    const mh = areas.maxHeight ?? {};

    const arrival = fh.arrivalTime
      ? formatArrivalTime(fh.arrivalTime)
      : (fh.condition ?? "");

    const maxH = mh
      ? `${mh.value}m`
      : "";

    [areas.grade.replace("MajorWarning","大津波警報").replace("Warning","津波警報").replace("Watch","津波注意報") ?? "", areas.name ?? "", arrival, maxH]
      .forEach(t => {
        const td = document.createElement("td");
        td.textContent = t;
        tr.appendChild(td);
      });

    tbody.appendChild(tr);
  });

  updatePageInfo();
}

/* データ更新 */
async function updateTable() {
  try {
    const res = await fetch(url);
    const data = await res.json();

    allItems = data[0].areas??[];
    console.log(allItems);
    currentPage = 0;
    renderPage(currentPage);

    if (rotateTimer) clearInterval(rotateTimer);

    if (allItems.length > pageSize) {
      rotateTimer = setInterval(() => {
        currentPage = (currentPage + 1) % Math.ceil(allItems.length / pageSize);
        renderPage(currentPage);
      }, 15000);
    }

    document.getElementById("updatedTime").textContent =
      `最終更新：${new Date().toLocaleTimeString("ja-JP")}`;

  } catch (e) {
    console.error("更新エラー", e);
  }
}

/* フルスクリーン */
document.getElementById("screen").addEventListener("click", () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(()=>{});
  }
});

updateTable();
setInterval(updateTable, 60000);
</script>

</body>
</html>
